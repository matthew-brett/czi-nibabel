
# NiTransforms: a NiBabel module for I/O of spatial transforms estimated with neuroimaging tools and their manipulation in Python

**Repository**: https://github.com/poldracklab/nitransforms (we should probably move it over to nipy, happy with that).

**Paper**: [ISBI Abstract](https://doi.org/10.1109/ISBI45749.2020.9098466) & [preprint](https://doi.org/10.31219/osf.io/8aq7b).

**JOSS Submission**: Ready on the repo, was postponed due to COVID and never got back to submitting it.


**About *NiTransforms***
Spatial transforms formalize mappings between coordinates of objects in biomedical images. Transforms typically are the outcome of image registration methodologies, which estimate the alignment between two images. Image registration is a prominent task present in nearly all standard image processing and analysis pipelines. The proliferation of software implementations of image registration methodologies has resulted in a spread of data structures and file formats used to preserve and communicate transforms. This segregation of formats precludes the compatibility between tools and endangers the reproducibility of results. We propose a software tool capable of converting between formats and resampling images to apply transforms generated by the most popular neuroimaging packages and libraries (AFNI, FSL, FreeSurfer, ITK, and SPM). The proposed software is subject to continuous integration tests to check the compatibility with each supported tool after every change to the code base. Compatibility between software tools and imaging formats is a necessary bridge to ensure the reproducibility of results and enable the optimization and evaluation of current image processing and analysis workflows.

<!---
MB - note to self.  Argument for expanding Nibabel's ability to cover
interoperation between libraries.  Important because scientists cannot, in
general, read or write C or C++ with any fluency.  Therefore, they cannot
review, extend, fix their core libraries, and they cannot learn from the
algorithms as expressed in the code.  Yes, keep C / C++ as base layer for some
libraries, that need to be fast, but make it easy to work with these libraries
in a language that scientists can read.
-->

---

As you will see, the paper itself attempted to be very educational. There we describe clearly what's the problem, why there's no other package like NiTransforms and why we see it as a module within NiBabel in the long run.

In the remaining of the document, I'll copy and paste what I can scratch out from previous CZI calls and other grants. Mentions to BIDS-Derivatives, X5 format, etc can be removed or at least toned down so that it is not the focus.

<!---
MB: note to self : [X5 format](https://bids.neuroimaging.io/bep014)
-->

---

### From CZI Cycle 1

**SD1. Spatial transformations of n-D imaging [growth, ecosystem coordination]**. Aligning the information contained in 2D/3D images or contours/surfaces is a ubiquitous problem in computer vision. In the particular context of neuroimaging, image alignment has an endless number of applications, e.g., tracking anatomical changes of tumor growth. Spatial alignment is also fundamental for fusion of multimodal data obtained with different instruments (e.g., MRI and PET). Some other applications may treat the alignment information as experimental data. For instance, phenotypic and developmental information that could be encoded in the flows of spatial migration of cells in their specialization identified using microscopy. However, existing tools to estimate and analyze spatial transformation data use custom formats, even for the most simple linear transforms. Therefore, there is a clear necessity for standardizing transformation data structures for the sake of compatibility. With support by the BRAIN-Initiative (R24MH114705) and the participation of developers of relevant neuroimaging packages, we have drafted a new file format called X5 [10] to address such concerns. SD1 will address the implementation of the format, along with aggregating into Nibabel the tooling to ease the usage of transformations in biomedical imaging.

(SD1 = Software Development action item 1)

<!---
MB - note to self - "ecosystem coordination" and Nibabel.  Traditional mode is
to build high-level libraries on top of base layer, and teach the high-level
libraries.  We propose to teach *first* the base layer, and *then* the
higher-level layers.

> That which I cannot build, I do not understand.

The point here is that extending Nibabel across the ecosystem makes Nibabel the
home key of Neuroimaging.

[Build you own light-sabre](https://www.infoq.com/presentations/Live-Programming)
-->

### From CZI Cycle 2

#### Aim 3. Extension of NiBabel for spatial transforms
We address one void area in the compatibility between neuroimaging tools and formats, extending NiBabel's API. [GitHub issues can be found replacing XX with the issue # in the URL - https://github.com/poldracklab/nitransforms/issues/XX]

CO3.1. Submission to Journal of Open Source Software [[nitransforms#44](https://github.com/poldracklab/nitransforms/issues/44), month 1].

SD3.2. Support for ITK's HDF5-format transforms [[nitransforms#4](https://github.com/poldracklab/nitransforms/issues/4), month 1]

SD3.3. Implement transforms mappings [[nitransforms#46](https://github.com/poldracklab/nitransforms/issues/46), month 2]

SD3.4. Revise unit tests [[nitransforms#37](https://github.com/poldracklab/nitransforms/issues/37), [nitransforms#40](https://github.com/poldracklab/nitransforms/issues/40), [nitransforms#52](https://github.com/poldracklab/nitransforms/issues/52), month 3].

SD3.5. Generate API documentation [[nitransforms#58](https://github.com/poldracklab/nitransforms/issues/58), month 3].

SD3.6. Implement the inversion of nonlinear, nonparametric transforms [[nitransforms#56](https://github.com/poldracklab/nitransforms/issues/56), months 3-5]

SD3.7. Support for nonparametric transforms of surfaces [[nitransforms#57](https://github.com/poldracklab/nitransforms/issues/57), months 5-12].

SD3.8. Integration into NiBabel [month 12].
